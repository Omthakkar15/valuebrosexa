name: Deploy to IIS

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: self-hosted

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Deploy to wwwroot
        shell: powershell
        run: |
          $ErrorActionPreference = "Stop"

          $target = "C:\inetpub\wwwroot"

          # Ensure wwwroot exists
          if (!(Test-Path $target)) {
            New-Item -ItemType Directory -Path $target | Out-Null
          }

          # Remove existing files
          Get-ChildItem -Path $target -Recurse -Force | Remove-Item -Recurse -Force

          # Copy files from repo to wwwroot
          Copy-Item -Path "$env:GITHUB_WORKSPACE\*" -Destination $target -Recurse -Force
